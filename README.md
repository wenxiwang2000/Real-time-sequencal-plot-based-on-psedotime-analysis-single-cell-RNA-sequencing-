# Malpighian Tubule Single-Cell Analysis (Scanpy + optional Streamlit UI)

This repository provides a reproducible, parameter-driven single-cell RNA-seq workflow for Cell Ranger `filtered_feature_bc_matrix` outputs, implemented in Python/Scanpy with an optional Streamlit front-end used **only** for clean parameter entry and output preview (the analysis always runs in backend code, not inside Streamlit state). The core pipeline follows a standard Scanpy flow—load 10x matrices, compute QC metrics (genes/counts/mt%), filter cells/genes with CLI-controlled thresholds, normalize + log1p + select HVGs, run PCA → neighbors → Leiden clustering → UMAP, and export cluster marker genes to Excel—matching the structure of the reference `sc_stage_pipeline.py`. :contentReference[oaicite:0]{index=0} It supports multi-sample / multi-stage processing and optional Harmony batch integration (example command shown in the provided usage notes). :contentReference[oaicite:1]{index=1} The workflow is designed to achieve strong resolution of key Malpighian tubule and associated tissues using curated marker genes, including secondary cells (tiptop/castor), leptophragmata (dachshund/NHA1), principal cells (cut; may show low cut in SCs), enteroendocrine cells (Allatostatin C, DH37/47, NPF; also consider Tachykinin), muscle (Mef2), trachea (breathless/Gasp), perinephric membrane (twi, FGFR), enterocytes (GATAe), hindgut/rectal epithelia (byn), and ureter (hector). :contentReference[oaicite:2]{index=2} Users can iteratively refine outcomes by tuning a small set of high-impact parameters (QC cutoffs, `n_hvg`, `n_pcs`, `n_neighbors`, and Leiden `resolution`) while keeping the workflow fully reproducible and transparent through saved `.h5ad` objects, QC/UMAP figures, and marker tables; this hybrid design combines the robustness of code-first analysis with a minimal, aesthetic UI that reduces “software-flow” side effects while making reruns fast and stress-free.
